### Scripts overview and production runbook

This folder contains CLI entrypoints for preprocessing, routing, simulation, analysis, visualization, and testing. The productionized flow is designed for Windows PowerShell stability: one short command per line, no piping or chaining, and non-interactive behavior.

### Environment setup (PowerShell)

- Activate your environment first:
```
conda activate my_gemini_env
```
- Avoid piping/chaining (no `|`, `;`, or `&&`).
- Keep commands short; do not paste long single-line commands that wrap.

### 1) Preprocess: Extract course data (OSM â†’ course assets)

Core command to build course assets under `courses/<course>/`:
```
python scripts/routing/extract_course_data.py --course "Pinetree Country Club" --clubhouse-lat 34.0379 --clubhouse-lon -84.5928 --output-dir courses/pinetree_country_club
```
Optional nearby streets (for delivery shortcuts) and combined network:
```
python scripts/routing/extract_course_data.py --course "Pinetree Country Club" --clubhouse-lat 34.0379 --clubhouse-lon -84.5928 --include-streets --street-buffer 750 --course-buffer 100 --output-dir courses/pinetree_country_club
```

Generated files (subset):
- `geojson/course_polygon.geojson`, `geojson/holes.geojson`, `geojson/tees.geojson`, `geojson/greens.geojson`
- `pkl/cart_graph.pkl` (+ optional `pkl/street_graph.pkl`, `pkl/combined_routing_graph.pkl`)
- `config/simulation_config.json` (merged defaults)

Sanity check (optional):
```
python scripts/routing/test_routing_integration.py
```

### 2) Run simulations (unified CLI)

The single entrypoint `scripts/sim/run_unified_simulation.py` covers all supported modes. Results are written under `outputs/`.

- Beverage carts GPS only (1..N carts):
```
python scripts/sim/run_unified_simulation.py --mode bev-carts --course-dir courses/pinetree_country_club --num-runs 3 --num-carts 2
```

- Beverage cart + golfer groups (sales simulation, 1 cart):
```
python scripts/sim/run_unified_simulation.py --mode bev-with-golfers --course-dir courses/pinetree_country_club --num-runs 2 --groups-count 4 --groups-interval-min 15 --first-tee 09:00 --order-prob 0.4 --avg-order-usd 12.0
```

- Golfers-only (generate golfer GPS tracks):
```
python scripts/sim/run_unified_simulation.py --mode golfers-only --course-dir courses/pinetree_country_club --num-runs 1 --groups-count 8 --groups-interval-min 10 --first-tee 08:30
```

- Delivery runner (0..N groups, dynamic orders):
```
python scripts/sim/run_unified_simulation.py --mode delivery-runner --course-dir courses/pinetree_country_club --num-runs 2 --groups-count 4 --groups-interval-min 15 --first-tee 09:00 --order-prob-9 0.5 --prep-time 10 --runner-speed 6.0 --revenue-per-order 25.0 --sla-minutes 30
```

Notes:
- To build groups from `tee_times_config.json` instead of manual counts, pass `--tee-scenario typical_weekday` (or use `--tee-scenario none` to disable).
- Logging level is controlled with `--log-level` (default: INFO).

### 3) Orchestrate multiple runs (optional)

Small matrix of unified runs:
```
python scripts/sim/run_unified_matrix.py --course-dir courses/pinetree_country_club --log-level INFO
```
Preview commands without executing:
```
python scripts/sim/run_unified_matrix.py --dry-run
```

### 4) Analysis and visualization (optional)

- Delivery runner metrics and summaries are generated by the unified runner and saved alongside outputs. Additional analysis tools:
  - `scripts/analysis/analyze_simulation_results.py`
  - `scripts/analysis/analyze_delivery_runner_metrics.py`
  - `scripts/analysis/analyze_bev_cart_metrics.py`

- Visualization helpers:
  - `scripts/viz/view_cart_network.py`
  - `scripts/viz/render_single_delivery_png.py`

### Phase wrappers used by tests/CI

These wrappers remain for regression tests and can be run directly if needed:
- `scripts/sim/phase_01_beverage_cart_only/run_bev_cart_phase1.py`
- `scripts/sim/phase_02_golfer_only/run_golfer_only_phase2.py`
- `scripts/sim/phase_11_two_beverage_carts/run_bev_cart_phase11.py`
- `scripts/sim/phase_12_golfer_and_bev_cart/run_phase12_golfer_and_bev.py`

Run the full regression locally:
```
python scripts/test/run_all_phases.py
```

### Active vs archived scripts

Active, supported entrypoints:
- `scripts/routing/extract_course_data.py` (core preprocessing)
- `scripts/routing/test_routing_integration.py` (routing sanity check)
- `scripts/sim/run_unified_simulation.py` (all simulation modes)
- `scripts/sim/run_unified_matrix.py` (optional orchestrator)
- `scripts/sim/run_scenarios_batch.py` (config-driven batches)
- `scripts/sim/run_single_golfer_simulation.py` (simple single-run CLI)
- `scripts/sim/generate_simple_tracks.py` (used internally by library)
- `scripts/analysis/*`, `scripts/viz/*`, `scripts/test/*`, `scripts/sim/phase_*/` (kept)

Superseded or experimental scripts have been moved to `scripts/_archive/`. Do not use archived scripts in production; see `_archive/README.md` for details.


